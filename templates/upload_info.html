<!doctype html>
<html lang="it">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Avistamento fototrappola</title>

        <!-- Bulma CSS -->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bulma@1.0.4/css/bulma.min.css"
        />

        <!-- Leaflet CSS -->
        <link
            rel="stylesheet"
            href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
            crossorigin=""
        />

        <style>
            #map {
                height: 400px;
                width: 100%;
                border-radius: 8px;
            }
            video {
                max-width: 100%;
                margin-top: 1rem;
                border-radius: 8px;
            }
        </style>

        <!-- HTMX -->
           <script src="https://unpkg.com/htmx.org@1.9.10"></script>

    </head>
    <body>
        <section class="section">
            <div class="container">
                <h1 class="title is-3">Avistamento fototrappola</h1>

                {% with messages = get_flashed_messages(with_categories=true) %}
                      {% if messages %}
                        <div id="flashes">
                          {% for category, msg in messages %}
                            {# Map Flask categories to Bulma notification classes #}
                            {% set bulma_class = {
                              'success': 'is-success',
                              'warning': 'is-warning',
                              'info':    'is-info',
                              'danger':  'is-danger',
                              'error':   'is-danger'
                            }[category] if category in ['success','warning','info','danger','error'] else 'is-light' %}

                            <div class="notification {{ bulma_class }}">
                              <button class="delete" aria-label="dismiss"></button>
                              {{ msg }}
                            </div>
                          {% endfor %}
                        </div>
                      {% endif %}
                    {% endwith %}
                    {% if video_url %}
                <div class="box mt-5">
                    <h2 class="subtitle is-4">Anteprima video caricato</h2>
                    <video
                        id="video_camtrap"
                        src="{{ video_url }}"
                        width="720"
                        preload="metadata"
                    ></video>
                    <p class="mt-3">
                        <strong>Data:</strong> {{ date }}<br />
                        <strong>Ora:</strong> {{ time_ }}<br />
                    </p>
                </div>
                {% endif %}

                <form
                    id="uploadForm"
                    method="post"
                    action="{{ url_for('save_info') }}"
                    enctype="multipart/form-data"
                >
                    <input
                        type="hidden"
                        name="original_file_name"
                        value="{{ original_file_name }}"
                    />
                    <input
                        type="hidden"
                        name="new_file_name"
                        value="{{ new_file_name }}"
                    />
                    <input
                        type="hidden"
                        name="file_content_md5"
                        value="{{ file_content_md5 }}"
                    />
                    <input type="hidden" name="date" value="{{ date }}" />
                    <input type="hidden" name="time_" value="{{ time_ }}" />
                    <div class="field">
                        <label class="label">Operatore</label>
                        <div class="control">
                            <input
                                class="input"
                                name="operator"
                                type="text"
                                placeholder="operatore"
                                value="{{ operator }}"
                                readonly
                            />
                        </div>
                    </div>
                    <div class="columns is-multiline">
                        <div class="column is-third">
                            <div class="field">
                                <label class="label">ID fototrappola</label>
                                <div class="control">
                                    <div class="select">

                                    <!--    <select id="codice_fototrappola"     name="codice_fototrappola"          required       >
                                         <option value="">Seleziona un codice</option>
                                         {% for foto in fototrappole %}
                                         <option value="{{ foto }}">{{ foto.codice }}</option>
                                         {% endfor %}
                                     </select>
-->
                                     <select name="camtrap_id"
                                         hx-get="/get_fototrappola_data"
                                         hx-trigger="change"
                                        hx-target="#details"
                                         hx-include="this"
                                     >
                                         <option value="">-- scegli una fototrappola --</option>
                                         {% for foto in fototrappole %}
                                         <option value="{{ foto.codice }}" {% if camtrap_id==foto.codice %}selected{%endif%}>{{ foto.codice }}</option>
                                         {% endfor %}
                                     </select>

                                    </div>

                                   <!-- <input class="input" name="camtrap_id" type="text" required value="{{ camtrap_id }}" /> -->

                            </div>
                            </div>
                        </div>
                        <div class="column is-third">
                            <div id="details" class="box">
                                   {{ fototrappola_details }}
                             </div>
                        </div>
                        <div class="column is-third">
                            <div class="field">
                                <label class="label">Codice avistamento</label>
                                <div class="control">
                                    <input
                                        class="input"
                                        name="code"
                                        type="text"
                                        value="{{ code }}"
                                        required
                                    />
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="columns is-multiline">
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Numero di lupi</label>
                                <div class="control">
                                    <input
                                        class="input"
                                        name="wolf_number"
                                        type="number"
                                        min="0"
                                        max="120"
                                        step="1"
                                        required
                                        value="{{ wolf_number }}"
                                    />
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label" for="scalp">SCALP</label
                                >scalp: {{ scalp }}
                                <div class="control">
                                    <div class="select">
                                           <select id="scalp" name="scalp" required>
                                            <option value="">Seleziona un codice</option>
                                            <option value="C1" {% if scalp=="C1" %}selected{%endif%}>C1</option>
                                            <option value="C3" {% if scalp=="C3"  %}selected{%endif%}>C3</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="field">
                        <label class="label">Note</label>
                        <div class="control">
                            <textarea
                                name="note"
                                class="textarea"
                                placeholder="Digitate le vostre note..."
                            >
{{ notes }}</textarea
                            >
                        </div>
                    </div>

                    <div class="field is-grouped">
                        <div class="control">
                            <button class="button is-primary" type="submit">
                                Salva dati
                            </button>
                        </div>
                    </div>
                </form>



            </div>
        </section>



    </body>
</html>
